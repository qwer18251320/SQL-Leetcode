##  Window Function ##
# Rank #
ðŸ“Œ 176. Second Highest Salary

# è§£æ³•1. 
Select Max(Salary) As SecondHighestSalary
From Employee
Where salary < (Select Max(Salary)
                From Employee) 

Select Max(Salary) As SecondHighestSalary
From Employee
Where Salary not in (Select Max(Salary) From Employee);

# è§£æ³•2.
With cte As
(Select *, Dense_Rank() Over (Order By Salary Desc) As rnk
From Employee)

Select Max(Salary) As SecondHighestSalary
From cte
Where rnk=2


# Nth Highest Rank #
ðŸ“Œ 177. Nth Highest Salary
CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
  RETURN (
      # Write your MySQL query statement below.
      Select Max(s.salary)
      From (Select Dense_Rank() Over (Order By Salary Desc) As drank, salary
           From Employee) As s
      Where s.drank = N
  );
END



ðŸ“Œ 178. Rank Scores
Select score, Dense_Rank() Over (Order By Score Desc) As "rank"
From Scores



ðŸ“Œ 180. Consecutive Numbers
Select Distinct(l1.num) As ConsecutiveNums
From Logs l1, Logs l2, Logs l3
Where l1.id-l2.id=1
And l2.id-l3.id=1
And l1.num-l2.num=0
And l2.Num - l3.Num = 0;
And l2.Num - l3.Num = 0;


ðŸ“Œ 184. Department Highest Salary
è§£æ³•1.
Select d1.name As Department, e1.name As Employee, salary
From Employee e1 Left Join Department d1 
On d1.id = e1.departmentId
Where (departmentId, salary) In
(Select departmentId, Max(salary)
From Employee
Group By departmentId)


è§£æ³•2. rank()
Select d1.name As Department, e1.name As Employee, e1.salary
From department d1 Right Join 
(Select name, salary, Rank() Over (PARTITION BY departmentId Order By salary Desc) As rnk,departmentId
 From Employee) e1 
On d1.id=e1.departmentId
Where e1.rnk=1


ðŸ“Œ 512. Game Play Analysis II
è§£æ³• 1. ç¬¬ä¸€æ™‚åˆ»æƒ³çš„æ–¹æ³•çµ•å°æ˜¯éŒ¯çš„ï¼Œè¦å…ˆæ‰¾å‡ºmin date, åœ¨æ‰¾device_id
Select player_id, device_id
From Activity
Where (player_id, event_date) In
(Select player_id, Min(event_date) As event_date
From Activity 
Group By player_id) 

è§£æ³• 2. rank ()
With cte As
(Select*, Rank() Over(Partition By player_id Order By event_date ASC) As rnk
From Activity)

Select player_id, device_id
From cte
Where rnk =1
