# 612. Shortest Distance in a Plane
Select Min(Round(Sqrt(Pow(p1.x-p2.x,2)+Pow(p1.y-p2.y,2)),2)) As shortest
From point_2d p1, point_2d p2
Where p1.x != p2.x OR p1.y != p2.y;

Select Min(Round(Sqrt(Pow(p1.x-p2.x,2)+Pow(p1.y-p2.y,2)),2)) As shortest
From point_2d p1 Join point_2d p2
On p1.x != p2.x OR p1.y != p2.y;

## Power(x,y) or Pow(x,y) = x^y
## sqrt((x1-x2)^2+(y1-y2)^2)



# 1098. Unpopular Books
Select Books.book_id, name
From books
Where available_from  < "2019-05-23"
And book_id NOT IN (Select book_id
                    From Orders
                    Where dispatch_date Between "2018-06-23" 
                    And "2019-06-23"
                    Group By book_id
                    Having Sum(quantity) >= 10);

## some books available_from early than '2019-05-23', but no sales during '2018-06-23' and '2019-06-23' - group by cannot reflect those book sales



# 1112. Highest Grade For Each Student
Select student_id, Min(course_id) AS course_id, grade
From Enrollments
Where (student_id, grade) In (Select student_id, Max(grade) As grade
                              From Enrollments
                              Group By student_id)
Group By student_id, grade
Order By student_id ASC;

## Where (x,y) In (x,y)
Group By x, y


# 550. Game Play Analysis IV
Select Round(Count(Distinct a2.player_id) / (Select Count(Distinct player_id) From Activity),2) As fraction
From Activity a1 Left Join
(Select player_id, Min(event_date) As first_log
From Activity
Group By player_id) As a2
On a1.player_id = a2.player_id And DateDiff(event_date, first_log) = 1;

## find first logged in, Date diff




# 585. Investments in 2016
Select Round(Sum(TIV_2016),2) As TIV_2016
From insurance
Where TIV_2015 IN (Select TIV_2015
                  From insurance
                  Group By TIV_2015
                  Having Count(*)>1)
And (LAT,LON) IN (Select LAT, LON
                  From insurance 
                  Group By LAT, LON
                  Having Count(*) =1);
## two creteria, familar to use Where(x,y) IN (subquery)



# 1070. Product Sales Analysis III
Select Sales.product_id, year As first_year, quantity, price
From Sales
Where (product_id, year) IN (Select product_id, Min(year) As year
                            From Sales
                            Group By product_id);
                            
## familar to use Where(x,y) IN (subquery)




# 1132. Reported Posts II
Select Round(Avg(percent),2) As average_daily_percent
From
(Select Count(Distinct r1.post_id)/Count(Distinct a1.post_id)*100 As percent
From Actions a1 Left Join Removals r1 Using(post_id)
Where extra = "spam" And action ="report"
Group By action_date) As total;

## for 2019-07-04 only one psot_id 2 remove, total two distinct id 2 and 4



# 1174. Immediate Food Delivery II
Select Round(Count(customer_id)/(Select Count(Distinct customer_id) From Delivery)*100,2)
As immediate_percentage
From Delivery
Where (customer_id,order_date) IN
(Select customer_id, Min(order_date) As order_date
From Delivery
Group By customer_id)
And order_date = customer_pref_delivery_date;

## Where (x,y) In (subquery)




# 1212. Team Scores in Football Tournament
Select team_id, team_name, 
Sum(Case When team_id=host_team And host_goals>guest_goals Then 3 Else 0 End)+
Sum(Case When team_id=guest_team And guest_goals>host_goals Then 3 Else 0 End)+
Sum(Case When team_id=host_team And host_goals=guest_goals Then 1 Else 0 End)+
Sum(Case When team_id=guest_team And guest_goals=host_goals Then 1 Else 0 End) As num_points
From Teams Left Join Matches
On team_id = host_team Or team_id = guest_team
Group By team_id
Order By num_points DESC, team_id ASC;

## sum(case when ...)+sum(case when...) As





# 1158. Market Analysis I
Select user_id As buyer_id, join_date, IFNULL(num,0) As orders_in_2019
From
(Select user_id, join_date
From Users) As u1
Left Join 
(Select buyer_id, Count(*) As num
From Orders
Where Left(order_date,4) = 2019
Group By buyer_id) As o1
On user_id = buyer_id;

## two subquery, ifnull



# 1264. Page Recommendations
# method 1
Select Distinct(page_id) As recommended_page
From 
(Select Case When user1_id = 1 Then user2_id
When user2_id = 1 Then user1_id End As user_id From Friendship) As f1
Join Likes Using(user_id)
Where page_id Not In
(Select page_id
From Likes
Where user_id = 1);
# method 2
Select Distinct(page_id) As recommended_page
From Likes
Where user_id IN
(Select user2_id As user_id
From Friendship 
Where user1_id = 1
Union All
Select user1_id As user_id
From Friendship
Where user2_id = 1)
And page_id NOT IN 
(Select page_id
From Likes
Where user_id = 1);
