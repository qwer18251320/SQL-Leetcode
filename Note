# 612. Shortest Distance in a Plane
Select Min(Round(Sqrt(Pow(p1.x-p2.x,2)+Pow(p1.y-p2.y,2)),2)) As shortest
From point_2d p1, point_2d p2
Where p1.x != p2.x OR p1.y != p2.y;

Select Min(Round(Sqrt(Pow(p1.x-p2.x,2)+Pow(p1.y-p2.y,2)),2)) As shortest
From point_2d p1 Join point_2d p2
On p1.x != p2.x OR p1.y != p2.y;

## Power(x,y) or Pow(x,y) = x^y
## sqrt((x1-x2)^2+(y1-y2)^2)



# 1098. Unpopular Books
Select Books.book_id, name
From books
Where available_from  < "2019-05-23"
And book_id NOT IN (Select book_id
                    From Orders
                    Where dispatch_date Between "2018-06-23" 
                    And "2019-06-23"
                    Group By book_id
                    Having Sum(quantity) >= 10);

## some books available_from early than '2019-05-23', but no sales during '2018-06-23' and '2019-06-23' - group by cannot reflect those book sales



# 1112. Highest Grade For Each Student
Select student_id, Min(course_id) AS course_id, grade
From Enrollments
Where (student_id, grade) In (Select student_id, Max(grade) As grade
                              From Enrollments
                              Group By student_id)
Group By student_id, grade
Order By student_id ASC;

## Where (x,y) In (x,y)
Group By x, y


# 550. Game Play Analysis IV
Select Round(Count(Distinct a2.player_id) / (Select Count(Distinct player_id) From Activity),2) As fraction
From Activity a1 Left Join
(Select player_id, Min(event_date) As first_log
From Activity
Group By player_id) As a2
On a1.player_id = a2.player_id And DateDiff(event_date, first_log) = 1;

## find first logged in, Date diff




# 585. Investments in 2016
Select Round(Sum(TIV_2016),2) As TIV_2016
From insurance
Where TIV_2015 IN (Select TIV_2015
                  From insurance
                  Group By TIV_2015
                  Having Count(*)>1)
And (LAT,LON) IN (Select LAT, LON
                  From insurance 
                  Group By LAT, LON
                  Having Count(*) =1);
## two creteria, familar to use Where(x,y) IN (subquery)



# 1070. Product Sales Analysis III
Select Sales.product_id, year As first_year, quantity, price
From Sales
Where (product_id, year) IN (Select product_id, Min(year) As year
                            From Sales
                            Group By product_id);
                            
## familar to use Where(x,y) IN (subquery)




# 1132. Reported Posts II
Select Round(Avg(percent),2) As average_daily_percent
From
(Select Count(Distinct r1.post_id)/Count(Distinct a1.post_id)*100 As percent
From Actions a1 Left Join Removals r1 Using(post_id)
Where extra = "spam" And action ="report"
Group By action_date) As total;

## for 2019-07-04 only one psot_id 2 remove, total two distinct id 2 and 4
